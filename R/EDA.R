library('quantmod') # 주가데이터 불러오기
library("dplyr")

price_data <- getSymbols('^DJI',from = '2011-12-30', to = '2022-05-01',src='yahoo',auto.assign=FALSE)
price_data <- as.data.frame(price_data)
price_data <- subset(price_data, select=c("DJI.Close"))
dimnames(price_data)[2] = c("Close")

diff_per <- (price_data-lag(price_data))/price_data*100
diff_per <- na.omit(diff_per)
par(mfrow=c(2,1))
plot(price_data$Close,type="l", xlab="time", ylab = "Dow Jones Close")
plot(diff_per$Close,type="l", xlab="time", ylab = "Dow Jones diff(전일비)")

par(mfrow=c(1,1))
hist(diff_per$Close,breaks=100, xlab = "Dow Jones diff", ylab = "Count", main = "Dow Jones Close")

price_data_12 <- as.data.frame(getSymbols('^DJI',from = '2011-12-30', to = '2013-01-01',src='yahoo',auto.assign=FALSE))
price_data_13 <- as.data.frame(getSymbols('^DJI',from = '2012-12-30', to = '2014-01-01',src='yahoo',auto.assign=FALSE))
price_data_14 <- as.data.frame(getSymbols('^DJI',from = '2013-12-31', to = '2015-01-01',src='yahoo',auto.assign=FALSE))
price_data_15 <- as.data.frame(getSymbols('^DJI',from = '2014-12-31', to = '2016-01-01',src='yahoo',auto.assign=FALSE))
price_data_16 <- as.data.frame(getSymbols('^DJI',from = '2015-12-31', to = '2017-01-01',src='yahoo',auto.assign=FALSE))
price_data_17 <- as.data.frame(getSymbols('^DJI',from = '2016-12-30', to = '2018-01-01',src='yahoo',auto.assign=FALSE))
price_data_18 <- as.data.frame(getSymbols('^DJI',from = '2017-12-29', to = '2019-01-01',src='yahoo',auto.assign=FALSE))
price_data_19 <- as.data.frame(getSymbols('^DJI',from = '2018-12-30', to = '2020-01-01',src='yahoo',auto.assign=FALSE))
price_data_20 <- as.data.frame(getSymbols('^DJI',from = '2019-12-31', to = '2021-01-01',src='yahoo',auto.assign=FALSE))
price_data_21 <- as.data.frame(getSymbols('^DJI',from = '2020-12-31', to = '2022-01-01',src='yahoo',auto.assign=FALSE))

diff_per_12 <- na.omit((price_data_12$DJI.Close-lag(price_data_12$DJI.Close))/price_data_12$DJI.Close*100)
diff_per_13 <- na.omit((price_data_13$DJI.Close-lag(price_data_13$DJI.Close))/price_data_13$DJI.Close*100)
diff_per_14 <- na.omit((price_data_14$DJI.Close-lag(price_data_14$DJI.Close))/price_data_14$DJI.Close*100)
diff_per_15 <- na.omit((price_data_15$DJI.Close-lag(price_data_15$DJI.Close))/price_data_15$DJI.Close*100)
diff_per_16 <- na.omit((price_data_16$DJI.Close-lag(price_data_16$DJI.Close))/price_data_16$DJI.Close*100)
diff_per_17 <- na.omit((price_data_17$DJI.Close-lag(price_data_17$DJI.Close))/price_data_17$DJI.Close*100)
diff_per_18 <- na.omit((price_data_18$DJI.Close-lag(price_data_18$DJI.Close))/price_data_18$DJI.Close*100)
diff_per_19 <- na.omit((price_data_19$DJI.Close-lag(price_data_19$DJI.Close))/price_data_19$DJI.Close*100)
diff_per_20 <- na.omit((price_data_20$DJI.Close-lag(price_data_20$DJI.Close))/price_data_20$DJI.Close*100)
diff_per_21 <- na.omit((price_data_21$DJI.Close-lag(price_data_21$DJI.Close))/price_data_21$DJI.Close*100)

par(mfrow=c(3,4))
hist(diff_per_12,breaks=max(diff_per_12)-min(diff_per_12)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2012")
hist(diff_per_13,breaks=max(diff_per_13)-min(diff_per_13)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2013")
hist(diff_per_14,breaks=max(diff_per_14)-min(diff_per_14)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2014")
hist(diff_per_15,breaks=max(diff_per_15)-min(diff_per_15)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2015")
hist(diff_per_16,breaks=max(diff_per_16)-min(diff_per_16)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2016")
hist(diff_per_17,breaks=max(diff_per_17)-min(diff_per_17)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2017")
hist(diff_per_18,breaks=max(diff_per_18)-min(diff_per_18)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2018")
hist(diff_per_19,breaks=max(diff_per_19)-min(diff_per_19)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2019")
hist(diff_per_20,breaks=max(diff_per_20)-min(diff_per_20)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2020")
hist(diff_per_21,breaks=max(diff_per_21)-min(diff_per_21)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2021")
mtext("Dow Jones", outer = TRUE, cex = 1.5)

price_data_AAPL <- getSymbols('AAPL',from = '2011-12-30', to = '2022-05-01',src='yahoo',auto.assign=FALSE)
price_data_AAPL <- as.data.frame(price_data_AAPL)
price_data_AAPL <- subset(price_data_AAPL, select=c("AAPL.Close"))
dimnames(price_data_AAPL)[2] = c("Close")

diff_per_AAPL <- (price_data_AAPL-lag(price_data_AAPL))/price_data_AAPL*100
diff_per_AAPL <- na.omit(diff_per_AAPL)

par(mfrow=c(2,1))
plot(price_data_AAPL$Close,type="l", xlab="time", ylab = "Apple Close" , main = "Apple")
plot(diff_per_AAPL$Close,type="l", xlab="time", ylab = "Apple Diff(전일비)")

par(mfrow=c(1,1))
hist(diff_per$Close,breaks=100, xlab = "Apple Diff", ylab = "Count", main = "Apple Close")

price_data_12_AAPL <- as.data.frame(getSymbols('AAPL',from = '2011-12-30', to = '2013-01-01',src='yahoo',auto.assign=FALSE))
price_data_13_AAPL <- as.data.frame(getSymbols('AAPL',from = '2012-12-30', to = '2014-01-01',src='yahoo',auto.assign=FALSE))
price_data_14_AAPL <- as.data.frame(getSymbols('AAPL',from = '2013-12-31', to = '2015-01-01',src='yahoo',auto.assign=FALSE))
price_data_15_AAPL <- as.data.frame(getSymbols('AAPL',from = '2014-12-31', to = '2016-01-01',src='yahoo',auto.assign=FALSE))
price_data_16_AAPL <- as.data.frame(getSymbols("AAPL",from = '2015-12-31', to = '2017-01-01',src='yahoo',auto.assign=FALSE))
price_data_17_AAPL <- as.data.frame(getSymbols('AAPL',from = '2016-12-30', to = '2018-01-01',src='yahoo',auto.assign=FALSE))
price_data_18_AAPL <- as.data.frame(getSymbols('AAPL',from = '2017-12-29', to = '2019-01-01',src='yahoo',auto.assign=FALSE))
price_data_19_AAPL <- as.data.frame(getSymbols('AAPL',from = '2018-12-30', to = '2020-01-01',src='yahoo',auto.assign=FALSE))
price_data_20_AAPL <- as.data.frame(getSymbols('AAPL',from = '2019-12-31', to = '2021-01-01',src='yahoo',auto.assign=FALSE))
price_data_21_AAPL <- as.data.frame(getSymbols('AAPL',from = '2020-12-31', to = '2022-01-01',src='yahoo',auto.assign=FALSE))

diff_per_12_AAPL <- na.omit((price_data_12_AAPL$AAPL.Close-lag(price_data_12_AAPL$AAPL.Close))/price_data_12_AAPL$AAPL.Close*100)
diff_per_13_AAPL <- na.omit((price_data_13_AAPL$AAPL.Close-lag(price_data_13_AAPL$AAPL.Close))/price_data_13_AAPL$AAPL.Close*100)
diff_per_14_AAPL <- na.omit((price_data_14_AAPL$AAPL.Close-lag(price_data_14_AAPL$AAPL.Close))/price_data_14_AAPL$AAPL.Close*100)
diff_per_15_AAPL <- na.omit((price_data_15_AAPL$AAPL.Close-lag(price_data_15_AAPL$AAPL.Close))/price_data_15_AAPL$AAPL.Close*100)
diff_per_16_AAPL <- na.omit((price_data_16_AAPL$AAPL.Close-lag(price_data_16_AAPL$AAPL.Close))/price_data_16_AAPL$AAPL.Close*100)
diff_per_17_AAPL <- na.omit((price_data_17_AAPL$AAPL.Close-lag(price_data_17_AAPL$AAPL.Close))/price_data_17_AAPL$AAPL.Close*100)
diff_per_18_AAPL <- na.omit((price_data_18_AAPL$AAPL.Close-lag(price_data_18_AAPL$AAPL.Close))/price_data_18_AAPL$AAPL.Close*100)
diff_per_19_AAPL <- na.omit((price_data_19_AAPL$AAPL.Close-lag(price_data_19_AAPL$AAPL.Close))/price_data_19_AAPL$AAPL.Close*100)
diff_per_20_AAPL <- na.omit((price_data_20_AAPL$AAPL.Close-lag(price_data_20_AAPL$AAPL.Close))/price_data_20_AAPL$AAPL.Close*100)
diff_per_21_AAPL <- na.omit((price_data_21_AAPL$AAPL.Close-lag(price_data_21_AAPL$AAPL.Close))/price_data_21_AAPL$AAPL.Close*100)

par(mfrow=c(3,4),oma = c(0, 0, 2, 0))
hist(diff_per_12_AAPL,breaks=max(diff_per_12_AAPL)-min(diff_per_12_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2012")
hist(diff_per_13_AAPL,breaks=max(diff_per_13_AAPL)-min(diff_per_13_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2013")
hist(diff_per_14_AAPL,breaks=max(diff_per_14_AAPL)-min(diff_per_14_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2014")
hist(diff_per_15_AAPL,breaks=max(diff_per_15_AAPL)-min(diff_per_15_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2015")
hist(diff_per_16_AAPL,breaks=max(diff_per_16_AAPL)-min(diff_per_16_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2016")
hist(diff_per_17_AAPL,breaks=max(diff_per_17_AAPL)-min(diff_per_17_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2017")
hist(diff_per_18_AAPL,breaks=max(diff_per_18_AAPL)-min(diff_per_18_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2018")
hist(diff_per_19_AAPL,breaks=max(diff_per_19_AAPL)-min(diff_per_19_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2019")
hist(diff_per_20_AAPL,breaks=max(diff_per_20_AAPL)-min(diff_per_20_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2020")
hist(diff_per_21_AAPL,breaks=max(diff_per_21_AAPL)-min(diff_per_21_AAPL)*10, ylim=c(0,50), xlim = c(-15,13), xlab = "Diff", ylab = "Count", main = "2021")
mtext("Apple", outer = TRUE, cex = 1.5)

